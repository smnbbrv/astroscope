---
import '../styles/index.css';
import Layout from '../../../shared/Layout.astro';
---

<Layout title="Health Demo" package="@astroscope/health">
  <p class="text-lg mb-6">
    This demo shows the @astroscope/health integration for Kubernetes health probes.
  </p>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Endpoints</h2>
      <p class="mb-4">Health endpoints are available on port 9090:</p>
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Endpoint</th>
              <th>Purpose</th>
              <th>Returns 200 when</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code class="badge badge-ghost">/livez</code></td>
              <td>Liveness probe</td>
              <td>Server is running</td>
            </tr>
            <tr>
              <td><code class="badge badge-ghost">/startupz</code></td>
              <td>Startup probe</td>
              <td>Boot completed</td>
            </tr>
            <tr>
              <td><code class="badge badge-ghost">/readyz</code></td>
              <td>Readiness probe</td>
              <td>Boot completed + critical checks pass</td>
            </tr>
            <tr>
              <td><code class="badge badge-ghost">/healthz</code></td>
              <td>Detailed status</td>
              <td>Always (JSON)</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl mt-6">
    <div class="card-body">
      <h2 class="card-title">Try it</h2>
      <pre class="bg-base-300 p-4 rounded-lg overflow-x-auto text-sm"><code>{`# Check endpoints
curl http://localhost:9090/livez
curl http://localhost:9090/startupz
curl http://localhost:9090/readyz
curl http://localhost:9090/healthz | jq`}</code></pre>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl mt-6">
    <div class="card-body">
      <h2 class="card-title">Usage</h2>
      <pre class="bg-base-300 p-4 rounded-lg overflow-x-auto text-sm"><code>{`// astro.config.ts
import health from '@astroscope/health';

export default defineConfig({
  integrations: [
    boot(),
    health(), // auto mode, port 9090
  ],
});

// src/boot.ts
import { registerCheck } from '@astroscope/health';

export async function onStartup() {
  await db.connect();

  registerCheck('database', {
    check: () => db.ping(),
    critical: true,
  });
}`}</code></pre>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl mt-6">
    <div class="card-body">
      <h2 class="card-title">Modes</h2>
      <ul class="list-disc list-inside space-y-2">
        <li>
          <code class="badge badge-ghost">probes: 'auto'</code> (default) -
          Probes automatically enable/disable based on boot lifecycle
        </li>
        <li>
          <code class="badge badge-ghost">probes: 'custom'</code> -
          Full manual control via <code>probes.livez.enable()</code> etc.
        </li>
        <li>
          <code class="badge badge-ghost">server: false</code> -
          Don't start server, self-host via <code>probes.livez.response()</code>
        </li>
      </ul>
    </div>
  </div>
</Layout>
