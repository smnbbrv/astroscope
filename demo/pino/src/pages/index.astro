---
import '../styles/index.css';
import { log } from '@astroscope/pino';
import Layout from '../../../shared/Layout.astro';

log.info('rendering index page');

const dbLog = log.child({ component: 'db' });

dbLog.debug('simulating database query');

await new Promise((resolve) => setTimeout(resolve, 50));

log.info({ duration: 50 }, 'work completed');
---

<Layout title="Pino Logging Demo" package="@astroscope/pino">
  <p class="text-lg mb-6">
    This demo showcases <code class="badge badge-ghost">@astroscope/pino</code> HTTP logging. Check your console for
    structured JSON logs.
  </p>

  <div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
      <h2 class="card-title">Features</h2>
      <ul class="list-disc list-inside space-y-2">
        <li><strong>pino-http compliant</strong> - Same log structure and messages</li>
        <li><strong>Request-scoped logging</strong> - Via AsyncLocalStorage</li>
        <li><strong>Automatic request logging</strong> - "request completed" with timing</li>
        <li><strong>Log levels by status</strong> - info for 2xx/3xx, warn for 4xx, error for 5xx</li>
      </ul>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Test Endpoints</h2>
      <ul class="space-y-2">
        <li>
          <a href="/" class="link link-primary">GET /</a>
          <span class="badge badge-success ml-2">200 OK</span> - This page (info level)
        </li>
        <li>
          <a href="/api/data" class="link link-primary">GET /api/data</a>
          <span class="badge badge-success ml-2">200</span> - API endpoint with custom logging
        </li>
        <li>
          <a href="/api/slow" class="link link-primary">GET /api/slow</a>
          <span class="badge badge-warning ml-2">slow</span> - Slow endpoint (300ms delay)
        </li>
        <li>
          <a href="/api/error" class="link link-primary">GET /api/error</a>
          <span class="badge badge-error ml-2">500</span> - Error endpoint (error level)
        </li>
        <li>
          <a href="/not-found" class="link link-primary">GET /not-found</a>
          <span class="badge badge-warning ml-2">404</span> - Not found (warn level)
        </li>
        <li>
          <a href="/health" class="link link-primary">GET /health</a>
          <span class="badge badge-ghost ml-2">excluded</span> - Excluded from logging
        </li>
      </ul>
    </div>
  </div>
</Layout>
