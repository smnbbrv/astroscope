---
import '../styles/index.css';
import Layout from '../../../shared/Layout.astro';
---

<Layout title="OpenTelemetry Native ESM Demo" package="@astroscope/opentelemetry">
  <p class="text-lg mb-6">
    This demo shows native OpenTelemetry auto-instrumentation using Node.js ESM loader hooks.
  </p>

  <div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
      <h2 class="card-title">How it works</h2>
      <ul class="list-disc list-inside space-y-2">
        <li>
          Uses <code class="badge badge-ghost">node --import=./register.mjs</code> to load OpenTelemetry before the app
        </li>
        <li>Auto-instruments HTTP, Express, and other supported libraries</li>
        <li>No middleware required - instrumentation happens at the Node.js level</li>
      </ul>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
      <h2 class="card-title">Usage</h2>
      <pre class="bg-base-300 p-4 rounded-lg overflow-x-auto text-sm"><code>{`bun run build
bun run start:prod`}</code></pre>
    </div>
  </div>

  <div class="alert alert-warning mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
      ></path>
    </svg>
    <div>
      <h3 class="font-bold">Limitations</h3>
      <ul class="list-disc list-inside text-sm">
        <li>Only works in production builds (not dev mode)</li>
        <li>Not all instrumentations support ESM yet</li>
      </ul>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Try it</h2>
      <ul class="space-y-2">
        <li>
          <a href="/api/data" class="link link-primary">GET /api/data</a>
          <span class="badge badge-info ml-2">traced</span> - Generates traced HTTP request
        </li>
        <li>
          <a href="/health" class="link link-primary">GET /health</a>
          <span class="badge badge-ghost ml-2">health</span> - Health check
        </li>
      </ul>
    </div>
  </div>
</Layout>
